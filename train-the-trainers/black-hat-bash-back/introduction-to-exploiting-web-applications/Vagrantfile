Vagrant.configure("2") do |config|

  # This eases VirtualBox Guest Additions installation.
  config.vagrant.plugins = "vagrant-vbguest"

  # Juice Shop is our pretend Blue Team for this scenario.
  # This is just yanked from Juice Shop's own Vagrantfile.
  # I.e., keep this more-or-less aligned with whatever is
  # in `./Blue Team/vagrant/Vagrantfile`.
  config.vm.define "blue" do |c|
    c.vm.box = "ubuntu/xenial64"
    c.vm.hostname = "juice.sh"
    c.vm.network "private_network", ip: "192.168.63.10"
    c.vm.provision "file", source: "./Blue Team/vagrant/default.conf", destination: "/tmp/juice-shop/default.conf"
    c.vm.provision :shell, path: "./Blue Team/vagrant/bootstrap.sh"

    # We don't need VBox Guest Additions for the server.
    c.vbguest.auto_update = false

    # On GNU/Linux systems with VirtualBox, there is a limit to the
    # size of the virtual machine's name. Let's make it shorter to
    # avoid a very unhelpful and confusing error that spits out an
    # error string like "VERR_CFGM_NOT_ENOUGH_SPACE" to the console.
    # See also https://forums.virtualbox.org/viewtopic.php?t=41660
    c.vm.provider "virtualbox" do |v|
      v.name = "juiceshop_blue"
    end
  end

  # Any Debian-derived GNU/Linux will do. We just need OWASP ZAP.
  config.vm.define "red" do |c|
    c.vm.box = "debian/buster64"
    c.vm.network "private_network", ip: "192.168.63.11"
    c.vm.provision "shell", path: "./Red Team/provision.sh"
    c.vm.provider "virtualbox" do |v|
      # ZAP is a graphical Java app, so let's give it some help.
      v.memory = 2048
      v.customize ["modifyvm", :id, "--vram", "128"]
      v.customize ["modifyvm", :id, "--graphicscontroller", "vmsvga"]
    end

    c.vm.post_up_message = <<~EOF

            __
           /  l
         .'   :               __.....__..._  ____
        /  /   \\          _.-" $$SSSSSS$$SSSSSSSSSp.
       (`-: .qqp:    .--.'  .p.S$$$$SSSSS$$$$$$$$SSSSp.
        """yS$SSSb,.'.g._\\.SSSSS^^""       `S""^^$$$SSSb.
          :SS$S$$$$SSSSS^"""-. _.            `.   "^$$$SSb._.._
          SSS$$S$$SSP^/       `.               \\     "^$SSS$$SSb.
          :SSSS$SP^" :          \\  `-.          `-      "^TSS$$SSb
           $$$$S'    ;          db               ."        TSSSSSS$,
           :$$P      ;$b        $ ;    (        /   .-"   .S$$$$$$$;
             ;-"     :$ ^s.    d' $           .g. .'    .SSdSSSS$P"
            /     .-  T.  `b. 't._$ .- / __.-j$'.'   .sSSSdP^^^'
           /  /      `,T._.dP   "":'  /-"   .'       TSSP'
          :  :         ,\\""       ; .'    .'      .-""
         _J  ;         ; `.      /.'    _/    \\.-"
        /  "-:        /"--.b-..-'     .'       ;
       /     /  ""-..'            .--'.-'/  ,  :
      :S.   :     dS$ bug         `-i" ,',_:  _ \\
      :S$b  '._  dS$;             .'.-"; ; ; j `.l
       TS$b          "-._         `"  :_/ :_/
        `T$b             "-._
          :S$p._             "-.
           `TSSS$ "-.     )     `.      With great power
              ""^--""^-. :        \\     comes great responsibility.
                        ";         \\
                        :           `._
                        ; /    \\ `._   ""---.
                       / /   _      `.--.__.'
                      : :   / ;  :".  \\
                      ; ;  :  :  ;  `. `.
                     /  ;  :   ; :    `. `.
                    /  /:  ;   :  ;     "-'
                   :_.' ;  ;    ; :
                       /  /     :_l
                       `-'

      ~~~~~~~~ Anarcho-Tech NYC - Exploiting Web Applications ~~~~~~~~

      You now have a virtual machine with the OWASP Zed Attack Proxy
      installed, and a practice target located at IP 192.168.63.10.

      OWASP ZAP is a graphical application, so you'll need to log in
      via the virtual machine's GUI console.

      The username is: vagrant
      The password is: vagrant

      Once logged in, start the OWASP Zed Attack Proxy by clicking on
      the Applications menu and selecting Other -> ZAP from the menu,
      or by opening the terminal and running the `zap.sh` script from
      within the OWASP ZAP directory.

      Please use what you learn here for the betterment of humanity. Only
      share what you know with the people who you believe will do the same.
      Remember, intention is not impact. Kill all Nazis, kill all cops,
      especially the ones inside ourselves.
    EOF
  end

end
